
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://veslava-edu.github.io/dwes/2-PHP/16-WebScraping-sol/" rel="canonical"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.18" name="generator"/>
<title>16 WebScraping sol - DWES</title>
<link href="../../assets/stylesheets/main.7e37652d.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../stylesheets/custom.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script><script src="../../toggle-sidebar.js"></script></link><script src="../../js/unpkg.com/d3@7.js" type="text/javascript"></script><script src="../../js/unpkg.com/markmap-lib@0.18.js" type="text/javascript"></script><script src="../../js/unpkg.com/markmap-view@0.18.js" type="text/javascript"></script><style type="text/css">div.mkdocs-markmap {
    width: 100%;
    min-height: 1em;
    border: 1px solid grey;
}
.mkdocs-markmap > svg {
    width: 100%;
    height: 100%;
    display: block;
}
</style></head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#php-web-scraping-el-arte-de-la-extraccion-de-datos">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="DWES" class="md-header__button md-logo" data-md-component="logo" href="../.." title="DWES">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            DWES
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              16 WebScraping sol
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Cambiar a modo oscuro" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Cambiar a modo oscuro">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Cambiar a modo claro" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="black" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Cambiar a modo claro">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
        
  
  
    
  
  Inicio

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../1-ArquitecturaWEB/UD1-Arquitectura-Web-y-Software-en-Servidor/">
          
  
  
  Arquitectura WEB y Servidor

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../01-Introduccion/">
          
  
  
  PHP

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="#">
          
  
  
  Node.js

        </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="DWES" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="DWES">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    DWES
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Inicio
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    Arquitectura WEB y Servidor
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Arquitectura WEB y Servidor
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../1-ArquitecturaWEB/UD1-Arquitectura-Web-y-Software-en-Servidor/">
<span class="md-ellipsis">
    00 - Arquitectura-Web-y-Software-en-Servidor
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../1-ArquitecturaWEB/UD1.1-Entorno-WAMP/">
<span class="md-ellipsis">
    01 - Entorno-WAMP
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../1-ArquitecturaWEB/UD1.2-Virtualizacion-Docker/">
<span class="md-ellipsis">
    02 - Virtualizacion-Docker
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../1-ArquitecturaWEB/UD1.3-Control-Versiones-GIT/">
<span class="md-ellipsis">
    03 - Control-Versiones-GIT
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    PHP
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            PHP
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../01-Introduccion/">
<span class="md-ellipsis">
    01 - Introducción
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../02-Sintaxis/">
<span class="md-ellipsis">
    02 - Sintaxis
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../03-Control/">
<span class="md-ellipsis">
    03 - Estructuras de Control
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../04-Arrays-Funciones-Strings/">
<span class="md-ellipsis">
    04 - Arrays, Funciones y Strings
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../05-POO/">
<span class="md-ellipsis">
    05 - POO - Programación Orientada a Objetos
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../06-Include/">
<span class="md-ellipsis">
    06 - Include y Require
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../07-GET-POST-Formularios/">
<span class="md-ellipsis">
    07 - GET y POST - Formularios
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../08-Gesti%C3%B3n-de-estado-Cookies-Sesiones/">
<span class="md-ellipsis">
    08 - Gestión de estado - Cookies y Sesiones
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../09-Ficheros/">
<span class="md-ellipsis">
    09 - Ficheros
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../10-BasesDatos/">
<span class="md-ellipsis">
    10 - Bases de Datos
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../11-Navegacion/">
<span class="md-ellipsis">
    11 - Navegación
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../12-Dependencias/">
<span class="md-ellipsis">
    12 - Dependencias
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../13-Servicios-WEB/">
<span class="md-ellipsis">
    13 - Servicios WEB
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../14-Documentacion/">
<span class="md-ellipsis">
    14 - Documentación
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../15-LOGS/">
<span class="md-ellipsis">
    15 - Logs en PHP
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../16-WebScraping/">
<span class="md-ellipsis">
    16 - WebScraping
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../17-Testing/">
<span class="md-ellipsis">
    17 - Testing
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_18" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_18" id="__nav_3_18_label" tabindex="0">
<span class="md-ellipsis">
    Laravel
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_18_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_18">
<span class="md-nav__icon md-icon"></span>
            Laravel
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#">
<span class="md-ellipsis">
    L1 - Introducción a Laravel
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#">
<span class="md-ellipsis">
    L2 - Entorno
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#">
<span class="md-ellipsis">
    L3 - Eloquent ORM
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#">
<span class="md-ellipsis">
    L4 - Controladores
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#">
<span class="md-ellipsis">
    L5 - Almacenamiento
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#">
<span class="md-ellipsis">
    L6 - Vistas (Blade)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#">
<span class="md-ellipsis">
    L7 - Autenticación y Autorización
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#">
<span class="md-ellipsis">
    L8 - Sesiones y Cookies
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#">
<span class="md-ellipsis">
    L9 - Testing
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Node.js
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Node.js
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#">
<span class="md-ellipsis">
    01 - Intro a Node.js
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#">
<span class="md-ellipsis">
    02 - Intro a TypeScript
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#">
<span class="md-ellipsis">
    03 - Intro a NestJS
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#">
<span class="md-ellipsis">
    04 - Creación de Recursos
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#">
<span class="md-ellipsis">
    05 - TypeORM
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#">
<span class="md-ellipsis">
    06 - Testing
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#">
<span class="md-ellipsis">
    07 - Almacenamiento de Ficheros
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#">
<span class="md-ellipsis">
    08 - WebSockets
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#">
<span class="md-ellipsis">
    09 - Endpoints Avanzados
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#">
<span class="md-ellipsis">
    10 - MongoDB
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#">
<span class="md-ellipsis">
    11 - Seguridad
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#">
<span class="md-ellipsis">
    12 - Documentación
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#">
<span class="md-ellipsis">
    13 - Perfiles
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#">
<span class="md-ellipsis">
    14 - Despliegue
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#conceptos-fundamentales-el-kit-del-explorador-de-datos">
<span class="md-ellipsis">
      Conceptos Fundamentales: El Kit del Explorador de Datos
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#desarrollo-y-ejemplos-practicos">
<span class="md-ellipsis">
      Desarrollo y Ejemplos Prácticos
    </span>
</a>
<nav aria-label="Desarrollo y Ejemplos Prácticos" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#paso-1-la-peticion-llamando-a-la-puerta-de-la-web">
<span class="md-ellipsis">
      Paso 1: La Petición - Llamando a la Puerta de la Web
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#paso-2-el-mapa-del-tesoro-navegando-por-el-html-con-dom">
<span class="md-ellipsis">
      Paso 2: El Mapa del Tesoro - Navegando por el HTML con DOM
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#paso-3-la-herramienta-todo-en-uno-symfony-y-sus-componentes">
<span class="md-ellipsis">
      Paso 3: La Herramienta Todo-en-Uno - Symfony y sus Componentes
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#paso-4-afrontando-lo-inevitable-el-reto-del-javascript-con-navegadores-headless">
<span class="md-ellipsis">
      Paso 4: Afrontando lo Inevitable - El Reto del JavaScript con Navegadores Headless
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#aplicacion-en-el-mundo-real-quien-usa-esto">
<span class="md-ellipsis">
      Aplicación en el Mundo Real: ¿Quién Usa Esto?
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#para-saber-mas">
<span class="md-ellipsis">
      Para Saber Más
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ejercicios">
<span class="md-ellipsis">
      EJERCICIOS
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ejercicios-de-consolidacion">
<span class="md-ellipsis">
      Ejercicios de Consolidación
    </span>
</a>
<nav aria-label="Ejercicios de Consolidación" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#objetivo">
<span class="md-ellipsis">
      Objetivo:
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#setup-inicial">
<span class="md-ellipsis">
      Setup Inicial:
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tarea-a-realizar">
<span class="md-ellipsis">
      Tarea a realizar:
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#aplicacion-en-el-mundo-real">
<span class="md-ellipsis">
      Aplicación en el Mundo Real:
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#objetivo_1">
<span class="md-ellipsis">
      Objetivo:
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tarea-a-realizar_1">
<span class="md-ellipsis">
      Tarea a realizar:
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#setup-inicial_1">
<span class="md-ellipsis">
      Setup Inicial:
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#aplicacion-en-el-mundo-real_1">
<span class="md-ellipsis">
      Aplicación en el Mundo Real:
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ejercicios-de-refuerzo">
<span class="md-ellipsis">
      Ejercicios de Refuerzo
    </span>
</a>
<nav aria-label="Ejercicios de Refuerzo" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#objetivo_2">
<span class="md-ellipsis">
      Objetivo:
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tarea-a-realizar_2">
<span class="md-ellipsis">
      Tarea a realizar:
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pistas">
<span class="md-ellipsis">
      Pistas:
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#aplicacion-en-el-mundo-real_2">
<span class="md-ellipsis">
      Aplicación en el Mundo Real:
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ejercicios-de-ampliacion">
<span class="md-ellipsis">
      Ejercicios de Ampliación
    </span>
</a>
<nav aria-label="Ejercicios de Ampliación" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#objetivo_3">
<span class="md-ellipsis">
      Objetivo:
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tarea-a-realizar_3">
<span class="md-ellipsis">
      Tarea a realizar:
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#aplicacion-en-el-mundo-real_3">
<span class="md-ellipsis">
      Aplicación en el Mundo Real:
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#revision-por-pares-peer-review">
<span class="md-ellipsis">
      Revisión por Pares (Peer Review):
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<!-- TEMA: PHP - Web Scraping -->
<h1 id="php-web-scraping-el-arte-de-la-extraccion-de-datos">PHP - Web Scraping: El Arte de la Extracción de Datos</h1>
<p>¡Buenas, equipo! Hoy nos convertimos en una especie de Indiana Jones digitales. Nuestra misión, si decidís aceptarla, es adentrarnos en la vasta y caótica jungla que es Internet, no para buscar ídolos de oro, sino un tesoro mucho más valioso en el siglo XXI: <strong>los datos</strong>. El Web Scraping es nuestra herramienta, nuestro látigo y nuestro mapa para navegar por templos de información (páginas web) y extraer artefactos de conocimiento (datos) de forma automática.</p>
<p>Piénsalo: ¿cómo crees que funcionan los comparadores de precios de vuelos o de hoteles? ¿O cómo las empresas de análisis de mercado saben qué se dice de sus productos en miles de foros y redes sociales? No hay un ejército de personas copiando y pegando sin parar. Hay "robots" de software, programas que hemos escrito nosotros, que hacen ese trabajo de forma incansable. Y hoy, vais a aprender a construir vuestros propios robots con PHP.</p>
<p><br/><hr/></p>
<h2 id="conceptos-fundamentales-el-kit-del-explorador-de-datos">Conceptos Fundamentales: El Kit del Explorador de Datos</h2>
<p>Antes de lanzarnos a la aventura, como todo buen explorador, necesitamos conocer nuestras herramientas. Aquí tenéis el equipamiento básico para cualquier <em>data-digger</em>.</p>
<div class="admonition note">
<p class="admonition-title">Definición: Web Scraping</p>
<p>Consiste en un proceso automatizado para navegar por páginas web, extraer la información que contienen (generalmente, a partir de su código HTML) y estructurarla para su posterior uso. Es como enseñarle a un programa a "leer" una web como lo haría una persona, pero a la velocidad de la luz.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Definición: Cliente HTTP</p>
<p>Es el software que se encarga de realizar la petición al servidor web, como si fuera un navegador. Su trabajo es decir "¡Oye, servidor, quiero el contenido de esta URL!". Herramientas como Guzzle en PHP son clientes HTTP de alto nivel que nos facilitan enormemente esta tarea.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Definición: DOM (Document Object Model)</p>
<p>Cuando un navegador recibe el código HTML de una página, no lo ve como un simple texto. Lo interpreta y construye una estructura de árbol en memoria llamada DOM. Cada etiqueta HTML (como <code>&lt;div&gt;</code>, <code>&lt;h1&gt;</code>, <code>&lt;p&gt;</code>) es una "rama" o una "hoja" de este árbol. Para hacer scraping, no trabajamos con el texto plano, sino que navegamos por este árbol para encontrar exactamente lo que buscamos.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Definición: Selector CSS y XPath</p>
<p>Son dos lenguajes que nos permiten escribir "direcciones" para localizar elementos dentro del árbol DOM.
*   <strong>Selector CSS</strong>: Es el que ya conocéis de CSS. <code>div.producte h2</code> es una dirección que dice: "Busca un <code>&lt;h2&gt;</code> que esté dentro de un <code>&lt;div&gt;</code> con la clase <code>producte</code>". Es intuitivo y directo.
*   <strong>XPath</strong>: Es más potente y antiguo. Permite navegar por el DOM con más flexibilidad, como si le dieras coordenadas GPS mucho más complejas. Por ejemplo <code>//ul/li/h3</code> dice "encuéntrame todos los <code>&lt;h3&gt;</code> que sean hijos de un <code>&lt;li&gt;</code> que a su vez sea hijo de un <code>&lt;ul&gt;</code>, sin importar dónde estén en el documento".</p>
</div>
<div class="admonition note">
<p class="admonition-title">Definición: Navegador Headless (Sin Cabeza)</p>
<p>Un navegador <em>headless</em> es un navegador web completo (como Chrome o Firefox) pero sin la parte gráfica, sin la ventana que vemos. Lo controlamos todo desde nuestro código. ¿Por qué es tan importante? Porque muchas webs modernas cargan su contenido dinámicamente con JavaScript. Un cliente HTTP normal solo ve el HTML inicial, que a menudo está vacío. Un navegador headless ejecuta el JavaScript y nos da acceso al contenido final, tal y como lo vería un usuario.</p>
</div>
<p><br/><hr/></p>
<h2 id="desarrollo-y-ejemplos-practicos">Desarrollo y Ejemplos Prácticos</h2>
<p>Manos a la obra. Vamos a seguir el proceso lógico de un scraper: primero pedir la página, luego analizarla y finalmente, lidiar con las webs más rebeldes.</p>
<h3 id="paso-1-la-peticion-llamando-a-la-puerta-de-la-web">Paso 1: La Petición - Llamando a la Puerta de la Web</h3>
<p>Todo empieza con una petición HTTP. Aunque PHP tiene funciones como <code>file_get_contents()</code> o la extensión cURL, el estándar de facto en la industria moderna es usar librerías que nos abstraigan de la complejidad. La reina aquí es <strong>Guzzle</strong>.</p>
<div class="admonition tip">
<p class="admonition-title">Instalando Guzzle</p>
<p>Para usar Guzzle en tu proyecto, solo necesitas a nuestro viejo amigo Composer:
<div class="highlight"><pre><span></span><code>composer<span class="w"> </span>require<span class="w"> </span>guzzlehttp/guzzle
</code></pre></div></p>
</div>
<p><strong>Ejemplo 1: Nuestra primera petición con Guzzle</strong>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="c1">// Fichero: guzzle_basico.php</span>
<span class="k">require</span> <span class="s1">'vendor/autoload.php'</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">GuzzleHttp\Client</span><span class="p">;</span>

<span class="c1">// Creamos un nuevo cliente Guzzle. Piensa en esto como abrir una ventana de Chrome.</span>
<span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Client</span><span class="p">();</span>

<span class="c1">// La URL del tesoro que queremos saquear.</span>
<span class="nv">$url</span> <span class="o">=</span> <span class="s1">'https://books.toscrape.com/'</span><span class="p">;</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="c1">// ¡Lanzamos la petición! Guzzle se encarga de toda la magia por debajo.</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>

    <span class="c1">// Obtenemos el cuerpo de la respuesta (el HTML) como un string.</span>
    <span class="nv">$html</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getBody</span><span class="p">();</span>

    <span class="k">echo</span> <span class="s2">"¡Petición exitosa! Hemos recibido "</span> <span class="o">.</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$html</span><span class="p">)</span> <span class="o">.</span> <span class="s2">" bytes de HTML."</span><span class="p">;</span>
    <span class="c1">// Aquí es donde, más adelante, empezaremos a procesar este HTML.</span>

<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\GuzzleHttp\Exception\GuzzleException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ¡Houston, tenemos un problema! Siempre controla las excepciones.</span>
    <span class="k">echo</span> <span class="s2">"Error en la petición: "</span> <span class="o">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></p>
<p><strong>Ejemplo 2: Petición con cabeceras personalizadas</strong></p>
<p>Algunas webs son un poco... selectivas. Si no pareces un navegador real, te cierran la puerta. Podemos "disfrazarnos" enviando una cabecera <code>User-Agent</code>.</p>
<div class="admonition info">
<p class="admonition-title">User-Agent</p>
<p>El User-Agent es como el DNI de tu navegador. Le dice al servidor qué software está haciendo la petición. Simular el de un navegador popular es una técnica básica de scraping.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="c1">// Fichero: guzzle_headers.php</span>
<span class="k">require</span> <span class="s1">'vendor/autoload.php'</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">GuzzleHttp\Client</span><span class="p">;</span>

<span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Client</span><span class="p">();</span>
<span class="nv">$url</span> <span class="o">=</span> <span class="s1">'https://www.imdb.com/search/name/?birth_monthday=12-10'</span><span class="p">;</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="c1">// Esta vez, añadimos un array de opciones a nuestra petición.</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nv">$url</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">'headers'</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">'User-Agent'</span> <span class="o">=&gt;</span> <span class="s1">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'</span><span class="p">,</span>
            <span class="s1">'Accept-Language'</span> <span class="o">=&gt;</span> <span class="s1">'es-ES,es;q=0.9'</span><span class="p">,</span> <span class="c1">// ¡Incluso pedimos la versión en español!</span>
        <span class="p">]</span>
    <span class="p">]);</span>

    <span class="nv">$html</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getBody</span><span class="p">();</span>
    <span class="k">echo</span> <span class="s2">"Recibido HTML de IMDb. ¡El disfraz ha funcionado!"</span><span class="p">;</span>
    <span class="c1">// var_dump($html);</span>

<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\GuzzleHttp\Exception\GuzzleException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"IMDb nos ha pillado. Error: "</span> <span class="o">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: left;">Herramienta</th>
<th style="text-align: left;">Caso de Uso Ideal</th>
<th style="text-align: left;">Ventajas</th>
<th style="text-align: left;">Desventajas</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong><code>file_get_contents()</code></strong></td>
<td style="text-align: left;">Scripts muy rápidos y sencillos donde no necesitas control.</td>
<td style="text-align: left;">Súper simple, una sola línea.</td>
<td style="text-align: left;">Cero control sobre cabeceras, timeouts, etc. Falla con facilidad.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>cURL nativo</strong></td>
<td style="text-align: left;">Cuando no puedes usar dependencias externas (raro).</td>
<td style="text-align: left;">Mucho control, muy potente.</td>
<td style="text-align: left;">Verboso, sintaxis compleja, fácil de cometer errores.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Guzzle</strong></td>
<td style="text-align: left;"><strong>El 99% de los casos.</strong> El estándar profesional.</td>
<td style="text-align: left;">API moderna y limpia, manejo de errores, middleware, asíncrono.</td>
<td style="text-align: left;">Requiere una dependencia externa (Composer).</td>
</tr>
</tbody>
</table>
<pre class="mermaid"><code>sequenceDiagram
    participant TuCodigo as Tu Código PHP
    participant Guzzle as Guzzle Client
    participant Servidor as Servidor Web Destino

    TuCodigo-&gt;&gt;Guzzle: $client-&gt;request('GET', url)
    Guzzle-&gt;&gt;Servidor: Construye y envía la petición HTTP
    Note right of Guzzle: GET /path HTTP/1.1&lt;br&gt;Host: example.com&lt;br&gt;User-Agent: ...
    Servidor--&gt;&gt;Guzzle: Responde con el código de estado y el HTML
    Note left of Servidor: HTTP/1.1 200 OK&lt;br&gt;Content-Type: text/html&lt;br&gt;&lt;html&gt;...&lt;/html&gt;
    Guzzle--&gt;&gt;TuCodigo: Devuelve un objeto Response
    TuCodigo-&gt;&gt;TuCodigo: $html = $response-&gt;getBody()
</code></pre>
<div class="admonition question">
<p class="admonition-title">Reflexionemos un poco...</p>
<ol>
<li>¿Por qué es una mala práctica general usar <code>file_get_contents()</code> para hacer scraping a un sitio web de producción?</li>
<li>Si una web te devuelve un error 403 (Forbidden) al intentar scrapear con Guzzle, ¿cuál sería la primera estrategia que probarías para solucionarlo, basándote en el ejemplo 2?</li>
<li>Investiga qué es una petición <code>POST</code> con Guzzle. ¿Para qué tipo de interacciones web la necesitarías al hacer scraping (piensa en formularios)?</li>
<li>¿Qué problemas de rendimiento podrían surgir si intentas scrapear 1000 URLs una tras otra de forma síncrona? (Pista: busca "Guzzle Asynchronous Requests").</li>
</ol>
</div>
<p><br/><hr/></p>
<h3 id="paso-2-el-mapa-del-tesoro-navegando-por-el-html-con-dom">Paso 2: El Mapa del Tesoro - Navegando por el HTML con DOM</h3>
<p>Ya tenemos el HTML. ¡Genial! Pero es un amasijo de etiquetas. Intentar sacar datos de ahí con expresiones regulares (regex) es como intentar operar a un paciente con una motosierra: puede que funcione, pero el desastre está casi garantizado.</p>
<div class="admonition danger">
<p class="admonition-title">¡Nunca uses Expresiones Regulares para parsear HTML!</p>
<p>El HTML puede ser inconsistente, tener errores o cambiar su estructura ligeramente. Una regex que funciona hoy, se romperá mañana. Es una solución frágil y poco profesional. Para eso se inventó el DOM.</p>
</div>
<p>Usaremos los componentes nativos de PHP: <code>DOMDocument</code> para crear el árbol DOM y <code>DOMXPath</code> para consultarlo.</p>
<p><strong>Ejemplo 1: Extrayendo títulos de libros con DOMDocument y XPath</strong></p>
<p>Vamos a volver a <code>books.toscrape.com</code> y extraer los títulos de todos los libros de la página principal.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="c1">// Fichero: dom_xpath.php</span>
<span class="k">require</span> <span class="s1">'vendor/autoload.php'</span><span class="p">;</span>

<span class="nv">$httpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Goutte\Client</span><span class="p">();</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="nv">$httpClient</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="s1">'https://books.toscrape.com/'</span><span class="p">);</span>
<span class="nv">$htmlString</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getBody</span><span class="p">();</span>

<span class="c1">// El HTML a menudo tiene errores. Esta línea mágica suprime los warnings.</span>
<span class="nb">libxml_use_internal_errors</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>

<span class="c1">// Creamos el objeto DOM</span>
<span class="nv">$doc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DOMDocument</span><span class="p">();</span>
<span class="nv">$doc</span><span class="o">-&gt;</span><span class="na">loadHTML</span><span class="p">(</span><span class="nv">$htmlString</span><span class="p">);</span>

<span class="c1">// Creamos el objeto XPath para hacer nuestras "queries"</span>
<span class="nv">$xpath</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DOMXPath</span><span class="p">(</span><span class="nv">$doc</span><span class="p">);</span>

<span class="c1">// Esta es la consulta XPath. Significa:</span>
<span class="c1">// "//article" -&gt; busca todas las etiquetas &lt;article&gt;</span>
<span class="c1">// "[@class='product_pod']" -&gt; que tengan el atributo class='product_pod'</span>
<span class="c1">// "//h3/a" -&gt; y dentro de ellas, busca un &lt;a&gt; dentro de un &lt;h3&gt;</span>
<span class="nv">$titulos</span> <span class="o">=</span> <span class="nv">$xpath</span><span class="o">-&gt;</span><span class="na">evaluate</span><span class="p">(</span><span class="s2">"//article[@class='product_pod']/h3/a"</span><span class="p">);</span>

<span class="k">echo</span> <span class="s2">"Libros encontrados en la página principal:</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$titulos</span> <span class="k">as</span> <span class="nv">$tituloNode</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// .nodeValue nos da el texto del nodo &lt;a&gt;</span>
    <span class="k">echo</span> <span class="s2">"- "</span> <span class="o">.</span> <span class="nv">$tituloNode</span><span class="o">-&gt;</span><span class="na">nodeValue</span> <span class="o">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Ejemplo 2: Extrayendo título y precio</strong></p>
<p>Ahora vamos a por los dos datos, título y precio, para asociarlos.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="c1">// Fichero: dom_xpath_completo.php</span>
<span class="k">require</span> <span class="s1">'vendor/autoload.php'</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">GuzzleHttp\Client</span><span class="p">;</span>

<span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Client</span><span class="p">();</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'https://books.toscrape.com/'</span><span class="p">);</span>
<span class="nv">$htmlString</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getBody</span><span class="p">();</span>

<span class="nb">libxml_use_internal_errors</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
<span class="nv">$doc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DOMDocument</span><span class="p">();</span>
<span class="nv">$doc</span><span class="o">-&gt;</span><span class="na">loadHTML</span><span class="p">(</span><span class="nv">$htmlString</span><span class="p">);</span>
<span class="nv">$xpath</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DOMXPath</span><span class="p">(</span><span class="nv">$doc</span><span class="p">);</span>

<span class="nv">$libros</span> <span class="o">=</span> <span class="p">[];</span>
<span class="c1">// Buscamos cada "tarjeta" de libro</span>
<span class="nv">$nodosLibro</span> <span class="o">=</span> <span class="nv">$xpath</span><span class="o">-&gt;</span><span class="na">evaluate</span><span class="p">(</span><span class="s2">"//article[@class='product_pod']"</span><span class="p">);</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$nodosLibro</span> <span class="k">as</span> <span class="nv">$nodo</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Dentro de cada tarjeta, buscamos el título y el precio RELATIVO a ese nodo.</span>
    <span class="c1">// El "." al principio de la query significa "empezar a buscar desde el nodo actual"</span>
    <span class="nv">$titulo</span> <span class="o">=</span> <span class="nv">$xpath</span><span class="o">-&gt;</span><span class="na">evaluate</span><span class="p">(</span><span class="s2">".//h3/a"</span><span class="p">,</span> <span class="nv">$nodo</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">getAttribute</span><span class="p">(</span><span class="s1">'title'</span><span class="p">);</span>
    <span class="nv">$precio</span> <span class="o">=</span> <span class="nv">$xpath</span><span class="o">-&gt;</span><span class="na">evaluate</span><span class="p">(</span><span class="s2">".//div[@class='product_price']/p[@class='price_color']"</span><span class="p">,</span> <span class="nv">$nodo</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">nodeValue</span><span class="p">;</span>

    <span class="nv">$libros</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'titulo'</span> <span class="o">=&gt;</span> <span class="nv">$titulo</span><span class="p">,</span> <span class="s1">'precio'</span> <span class="o">=&gt;</span> <span class="nv">$precio</span><span class="p">];</span>
<span class="p">}</span>

<span class="nb">print_r</span><span class="p">(</span><span class="nv">$libros</span><span class="p">);</span>
</code></pre></div>
<div class="language-markmap mkdocs-markmap"><markmap-data encoding="base64" hidden="true">IyBQYXJzZWFuZG8gSFRNTAoKIyMgRWwgQ2FtaW5vIE9zY3VybyDwn5G5Ci0gIioqRXhwcmVzaW9uZXMgUmVndWxhcmVzIChSZWdleCkqKiIKLSAiUsOhcGlkbyBwYXJhIGNvc2FzICpoaXBlciogc2VuY2lsbGFzLiIKLSAiKipFeHRyZW1hZGFtZW50ZSBmcsOhZ2lsKio6IHVuIGNhbWJpbyBtw61uaW1vIGVuIGVsIEhUTUwgeSBzZSByb21wZS4iCi0gIkRpZsOtY2lsIGRlIGxlZXIgeSBtYW50ZW5lci4iCi0gIkNvbnNpZGVyYWRvIHVuYSBtdXkgbWFsYSBwcsOhY3RpY2EuIgoKIyMgRWwgQ2FtaW5vIGRlbCBKZWRpIOKcqAotICIqKkRPTSBQYXJzZXJzKioiCi0gIkNvbnN0cnV5ZSB1biDDoXJib2wgbMOzZ2ljbyBkZWwgZG9jdW1lbnRvLiIKLSAiKipSb2J1c3RvIHkgZmlhYmxlKio6IGlubXVuZSBhIHBlcXVlw7FvcyBjYW1iaW9zIGRlIGZvcm1hdG8uIgotICJQZXJtaXRlIGLDunNxdWVkYXMgY29tcGxlamFzIHkgbmF2ZWdhY2nDs24uIgotICIqKkhlcnJhbWllbnRhcyoqOiAnRE9NRG9jdW1lbnQnLCAnRE9NWFBhdGgnLCBsaWJyZXLDrWFzIGRlIGFsdG8gbml2ZWwuIgotICJFbCBlc3TDoW5kYXIgcHJvZmVzaW9uYWwuIg==</markmap-data></div>
<div class="admonition question">
<p class="admonition-title">Reflexionemos un poco...</p>
<ol>
<li>Abre <code>books.toscrape.com</code> en tu navegador, inspecciona el código de un libro y trata de escribir la consulta XPath para extraer la URL de su imagen.</li>
<li>¿Cuál es la diferencia clave entre <code>nodeValue</code>, <code>textContent</code> y <code>getAttribute()</code> al trabajar con nodos del DOM? Pon un ejemplo de cuándo usarías cada uno.</li>
<li>La expresión <code>evaluate()</code> puede devolver un <code>DOMNodeList</code>. ¿Por qué es importante comprobar siempre si la consulta ha devuelto resultados antes de intentar acceder a un elemento como <code>$nodos[0]</code>?</li>
<li>¿Qué significa el <code>.</code> al principio de una consulta XPath como en <code>.//h3/a</code>? ¿Por qué es tan útil dentro de un bucle?</li>
</ol>
</div>
<p><br/><hr/></p>
<h3 id="paso-3-la-herramienta-todo-en-uno-symfony-y-sus-componentes">Paso 3: La Herramienta Todo-en-Uno - Symfony y sus Componentes</h3>
<p>Usar <code>DOMDocument</code> y <code>Guzzle</code> por separado está bien, pero ¿no sería genial tener una herramienta que hiciera la petición y nos diera directamente un objeto para "parsear" la respuesta? ¡Pues existe!</p>
<p>Durante años, la librería de referencia fue <strong>Goutte</strong>. Sin embargo, Goutte ahora está deprecada. ¡No pasa nada! Su creador, el de Symfony, nos dice que ahora usemos directamente los componentes que Goutte usaba por debajo. El principal es <code>Symfony\Component\BrowserKit\HttpBrowser</code>, que combina un cliente HTTP con un "parser" de DOM llamado <code>DomCrawler</code>.</p>
<div class="admonition tip">
<p class="admonition-title">Instalando los componentes de Symfony</p>
<div class="highlight"><pre><span></span><code>composer<span class="w"> </span>require<span class="w"> </span>symfony/http-client<span class="w"> </span>symfony/browser-kit<span class="w"> </span>symfony/dom-crawler
</code></pre></div>
</div>
<p><code>DomCrawler</code> es una maravilla. Nos permite usar tanto selectores CSS (más fáciles) como XPath (más potentes) sobre la marcha.</p>
<p><strong>Ejemplo 1: Scraping con HttpBrowser y selectores CSS</strong></p>
<p>Vamos a repetir el ejemplo de los libros, pero con la sintaxis moderna y limpia de Symfony.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="c1">// Fichero: symfony_css.php</span>
<span class="k">require</span> <span class="s1">'vendor/autoload.php'</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\BrowserKit\HttpBrowser</span><span class="p">;</span>

<span class="c1">// Instanciamos el navegador. ¡Ya está todo listo!</span>
<span class="nv">$browser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HttpBrowser</span><span class="p">();</span>

<span class="c1">// Hacemos la petición. El objeto devuelto, $crawler, es la clave.</span>
<span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$browser</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="s1">'https://books.toscrape.com/'</span><span class="p">);</span>

<span class="c1">// Usamos el método filter() con un selector CSS. ¡Como en jQuery!</span>
<span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">'article.product_pod h3 a'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">each</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$node</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// El método each() itera por todos los nodos que ha encontrado.</span>
    <span class="c1">// $node es un objeto Crawler individual para cada resultado.</span>
    <span class="k">echo</span> <span class="s2">"- "</span> <span class="o">.</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">()</span> <span class="o">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div>
<p><strong>Ejemplo 2: Extrayendo varios datos y navegando a otra página</strong></p>
<p>Lo increíble de <code>HttpBrowser</code> es que mantiene el "estado". Podemos hacer clic en enlaces y seguir navegando. Vamos a coger el primer libro, hacer clic en él y extraer su descripción detallada.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="c1">// Fichero: symfony_navegacion.php</span>
<span class="k">require</span> <span class="s1">'vendor/autoload.php'</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\BrowserKit\HttpBrowser</span><span class="p">;</span>

<span class="nv">$browser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HttpBrowser</span><span class="p">();</span>

<span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$browser</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="s1">'https://books.toscrape.com/'</span><span class="p">);</span>

<span class="c1">// Buscamos el enlace del primer libro.</span>
<span class="nv">$enlacePrimerLibro</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">'article.product_pod h3 a'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">link</span><span class="p">();</span>

<span class="c1">// Hacemos clic en el enlace. El objeto $browser ahora está en la nueva página.</span>
<span class="nv">$paginaLibro</span> <span class="o">=</span> <span class="nv">$browser</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="nv">$enlacePrimerLibro</span><span class="p">);</span>

<span class="c1">// Ahora el $crawler apunta a la página de detalle del libro.</span>
<span class="nv">$titulo</span> <span class="o">=</span> <span class="nv">$paginaLibro</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">'div.product_main h1'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">();</span>
<span class="c1">// El selector #product_description + p busca un &lt;p&gt; que venga justo después</span>
<span class="c1">// de un elemento con id="product_description".</span>
<span class="nv">$descripcion</span> <span class="o">=</span> <span class="nv">$paginaLibro</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">'#product_description + p'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">();</span>

<span class="k">echo</span> <span class="s2">"Título: </span><span class="si">{</span><span class="nv">$titulo</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">"Descripción: </span><span class="si">{</span><span class="nv">$descripcion</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: left;">Tipo de Selector</th>
<th style="text-align: left;">Sintaxis de Ejemplo</th>
<th style="text-align: left;">Pros</th>
<th style="text-align: left;">Contras</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>CSS</strong></td>
<td style="text-align: left;"><code>div#main p.highlight</code></td>
<td style="text-align: left;">Intuitiva, fácil de leer, ideal para el 80% de los casos.</td>
<td style="text-align: left;">Menos potente, no puede seleccionar elementos padre o basados en contenido de texto.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>XPath</strong></td>
<td style="text-align: left;"><code>//div[@id='main']/p[@class='highlight']</code></td>
<td style="text-align: left;">Extremadamente potente, puede navegar en cualquier dirección del DOM.</td>
<td style="text-align: left;">Sintaxis más compleja y verbosa, puede ser menos legible para consultas simples.</td>
</tr>
</tbody>
</table>
<div class="admonition question">
<p class="admonition-title">Reflexionemos un poco...</p>
<ol>
<li>Usando el ejemplo 2 como base, modifícalo para que, en lugar del primer libro, entre en el último libro de la página. (Pista: <code>-&gt;last()</code>).</li>
<li>¿Cómo harías para extraer el número de estrellas de un libro? Inspecciona el código y verás que la clase del <code>&lt;p&gt;</code> indica el número (<code>star-rating Three</code>). ¿Cómo accederías al atributo <code>class</code>?</li>
<li>El método <code>each()</code> es genial, pero ¿qué pasa si queremos meter los resultados en un array fuera de la función anónima? Investiga cómo usar la palabra clave <code>use</code> en los closures de PHP.</li>
<li>¿Para qué sirve el método <code>form()</code> en el componente <code>HttpBrowser</code>? Imagina que tienes que hacer scraping a una página que requiere login.</li>
</ol>
</div>
<p><br/><hr/></p>
<h3 id="paso-4-afrontando-lo-inevitable-el-reto-del-javascript-con-navegadores-headless">Paso 4: Afrontando lo Inevitable - El Reto del JavaScript con Navegadores Headless</h3>
<p>Hemos llegado al jefe final. Abres las herramientas de desarrollador, miras el HTML que te devuelve Guzzle y... está casi vacío. Ves un <code>&lt;div id="app"&gt;&lt;/div&gt;</code> y poco más. Pero en el navegador, la página está llena de contenido. ¿Qué brujería es esta?</p>
<p>Se llama <strong>renderizado del lado del cliente</strong> (Client-Side Rendering). El servidor envía un HTML mínimo y un gran fichero JavaScript. Es el navegador del usuario el que ejecuta ese JS para construir el HTML final y pedir los datos a una API. Nuestros scrapers anteriores son "tontos": no ejecutan JavaScript.</p>
<p>La solución: <strong>Symfony Panther</strong>, un navegador real (Chrome o Firefox) que controlamos desde PHP.</p>
<div class="admonition tip">
<p class="admonition-title">Instalando Symfony Panther</p>
<p><div class="highlight"><pre><span></span><code>composer<span class="w"> </span>require<span class="w"> </span>symfony/panther
</code></pre></div>
Panther intentará encontrar automáticamente una instalación de Chrome en tu sistema. ¡Magia!</p>
</div>
<p><strong>Ejemplo 1: Scrapeando una página que carga con JS</strong>
Vamos a usar <code>http://quotes.toscrape.com/js/</code>, una versión de la web de citas que carga todo con JavaScript. Si usaras Guzzle aquí, no verías ninguna cita.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="c1">// Fichero: panther_basico.php</span>
<span class="k">require</span> <span class="s1">'vendor/autoload.php'</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Panther\Client</span><span class="p">;</span>

<span class="c1">// Creamos un cliente que controla un Chrome real (pero invisible).</span>
<span class="nv">$client</span> <span class="o">=</span> <span class="nx">Client</span><span class="o">::</span><span class="na">createChromeClient</span><span class="p">();</span>

<span class="c1">// Panther también usa la interfaz de request y devuelve un Crawler.</span>
<span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="s1">'http://quotes.toscrape.com/js/'</span><span class="p">);</span>

<span class="c1">// Panther espera automáticamente un poco a que el JS se ejecute.</span>
<span class="c1">// Luego, podemos usar los mismos métodos que ya conocemos.</span>
<span class="nv">$primeraCita</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">'.quote span.text'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">();</span>

<span class="k">echo</span> <span class="s2">"La primera cita (cargada con JS) es: </span><span class="si">{</span><span class="nv">$primeraCita</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>

<span class="c1">// No olvides cerrar el navegador para liberar recursos.</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">quit</span><span class="p">();</span>
</code></pre></div>
<p><strong>Ejemplo 2: Interactuando con la página (scroll infinito)</strong></p>
<p>Panther no solo renderiza JS, ¡también puede simular acciones de usuario! Clics, rellenar formularios, hacer scroll... Vamos a la versión con scroll infinito y cargaremos más citas.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="c1">// Fichero: panther_scroll.php</span>
<span class="k">require</span> <span class="s1">'vendor/autoload.php'</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Panther\Client</span><span class="p">;</span>

<span class="nv">$client</span> <span class="o">=</span> <span class="nx">Client</span><span class="o">::</span><span class="na">createChromeClient</span><span class="p">();</span>
<span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="s1">'http://quotes.toscrape.com/scroll'</span><span class="p">);</span>

<span class="k">echo</span> <span class="s2">"Citas iniciales: "</span> <span class="o">.</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">'.quote'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">()</span> <span class="o">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>

<span class="c1">// Hacemos scroll hasta el final de la página para cargar más.</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">executeScript</span><span class="p">(</span><span class="s1">'window.scrollTo(0, document.body.scrollHeight);'</span><span class="p">);</span>

<span class="c1">// Esperamos a que el nuevo contenido aparezca.</span>
<span class="c1">// Panther es inteligente y puede esperar a que un elemento exista.</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">waitFor</span><span class="p">(</span><span class="s1">'.quote:nth-child(11)'</span><span class="p">);</span> <span class="c1">// Espera a que haya una 11ª cita.</span>

<span class="k">echo</span> <span class="s2">"Citas tras un scroll: "</span> <span class="o">.</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">'.quote'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">()</span> <span class="o">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>

<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">quit</span><span class="p">();</span>
</code></pre></div>
<pre class="mermaid"><code>graph TD
    subgraph "Inicio"
        A["¿Necesito extraer datos de una URL?"]
    end
    subgraph "Análisis"
        A --&gt; B["¿La página carga todo su contenido&lt;br&gt;en el HTML inicial?"]
        B -- SÍ --&gt; C["Usa un cliente HTTP rápido&lt;br&gt;&lt;b&gt;Symfony HttpBrowser / Guzzle&lt;/b&gt;"]
        B -- NO --&gt; D["¿El contenido se carga&lt;br&gt;con JavaScript (AJAX, etc.)?"]
    end
    subgraph "Solución"
        D -- SÍ --&gt; E["Necesitas un navegador real&lt;br&gt;que ejecute JS&lt;br&gt;&lt;b&gt;Symfony Panther&lt;/b&gt;"]
        D -- NO --&gt; C
        C --&gt; F["¡A scrapear!"]
        E --&gt; F
    end</code></pre>
<div class="admonition question">
<p class="admonition-title">Reflexionemos un poco...</p>
<ol>
<li>¿Cuál es la principal desventaja en rendimiento de usar Panther en comparación con Guzzle/HttpBrowser? ¿Por qué no usarías Panther para todo?</li>
<li>Entra en <code>imdb.com</code>. Verás que para ver más resultados de una búsqueda hay un botón "See more" que carga más actores con JS. ¿Cómo harías con Panther para hacer clic en ese botón y esperar a que aparezcan los nuevos resultados? (Pista: <code>-&gt;click()</code> y <code>-&gt;waitFor()</code>).</li>
<li>Panther tiene un método <code>-&gt;takeScreenshot('captura.png')</code>. ¿En qué situaciones de un proceso de scraping largo y desatendido crees que podría ser increíblemente útil esta función?</li>
<li>Investiga la diferencia entre <code>Client::createChromeClient()</code> y <code>Client::createFirefoxClient()</code>. ¿Por qué podría ser útil poder cambiar de navegador tan fácilmente?</li>
</ol>
</div>
<p><br/><hr/></p>
<h2 id="aplicacion-en-el-mundo-real-quien-usa-esto">Aplicación en el Mundo Real: ¿Quién Usa Esto?</h2>
<p>El Web Scraping no es un ejercicio académico, es una herramienta de negocio potentísima que usan desde startups hasta gigantes tecnológicos:</p>
<ul>
<li><strong>E-commerce y Marketplaces:</strong> Amazon, Google Shopping o comparadores como Skyscanner se nutren de datos scrapeados de miles de webs de aerolíneas y tiendas para ofrecerte el mejor precio.</li>
<li><strong>Inteligencia de Mercado:</strong> Las empresas scrapean foros, noticias y redes sociales para medir el sentimiento sobre sus productos, monitorizar a la competencia o identificar tendencias emergentes.</li>
<li><strong>Generación de Leads:</strong> Los equipos de ventas pueden scrapear directorios de empresas (como las Páginas Amarillas digitales) para encontrar potenciales clientes que cumplan ciertos criterios (por ejemplo, "restaurantes en Barcelona que no tengan página web").</li>
<li><strong>Entrenamiento de IA:</strong> ¿De dónde crees que sacan los modelos de lenguaje como ChatGPT tantísima información? Una gran parte proviene del scraping masivo de la web para "aprender" cómo hablamos y qué conocimiento existe.</li>
<li><strong>Periodismo de Datos:</strong> Los periodistas usan el scraping para recopilar y analizar grandes volúmenes de datos de fuentes públicas (como portales de transparencia gubernamental) para destapar historias y crear reportajes de investigación.</li>
</ul>
<p><br/><hr/></p>
<h2 id="para-saber-mas">Para Saber Más</h2>
<p>La aventura no ha hecho más que empezar. Si quieres convertirte en un maestro explorador de datos, aquí tienes algunos mapas del tesoro adicionales:</p>
<ol>
<li><strong>Documentación Oficial de Symfony BrowserKit:</strong> El manual de instrucciones de tu navaja suiza para el scraping sin JS. Esencial para entender todas las opciones.
    <a href="https://symfony.com/doc/current/components/browser_kit.html">https://symfony.com/doc/current/components/browser_kit.html</a></li>
<li><strong>Documentación Oficial de Symfony Panther:</strong> La guía para domar a la bestia del JavaScript. Imprescindible para entender el scraping moderno.
    <a href="https://symfony.com/doc/current/components/panther.html">https://symfony.com/doc/current/components/panther.html</a></li>
<li><strong>Web Scraping without getting blocked (ScrapingBee):</strong> Un artículo muy completo (en inglés) sobre las técnicas que usan las webs para bloquearte y cómo evitarlas (proxies, rotación de User-Agents, CAPTCHAs...). ¡Lectura obligatoria antes de scrapear a lo grande!
    <a href="https://www.scrapingbee.com/blog/web-scraping-without-getting-blocked/">https://www.scrapingbee.com/blog/web-scraping-without-getting-blocked/</a></li>
</ol>
<p><br/><hr class="double"/><br/></p>
<h2 id="ejercicios">EJERCICIOS</h2>
<hr/>
<!-- 
******************
*   EJERCICIOS   *  
******************
-->
<!-- Nombre de archivo sugerido: T12-Ejercicios-WebScraping.md -->
<h2 id="ejercicios-de-consolidacion">Ejercicios de Consolidación</h2>
<div class="admonition abstract">
<p class="admonition-title">1) El Scraper Novato: Rescatando Datos de 'BookWorld' | Nivel: Fácil</p>
<h5 id="objetivo"><strong>Objetivo:</strong></h5>
<p>Depurar un script de scraping simple, identificando y corrigiendo errores comunes en la selección de nodos y la extracción de datos.</p>
<h5 id="setup-inicial"><strong>Setup Inicial:</strong></h5>
<p>Un nuevo becario en tu empresa, DataHarvest Inc., ha intentado escribir un scraper para obtener los títulos y precios de la página principal de <code>books.toscrape.com</code> para el proyecto "MarketPulse", pero el script no funciona como se esperaba. Falla silenciosamente o arroja errores. Tu tarea es arreglarlo.</p>
<p><strong>Código a depurar:</strong>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="c1">// Fichero: debug_scraper.php</span>
<span class="k">require</span> <span class="s1">'vendor/autoload.php'</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\BrowserKit\HttpBrowser</span><span class="p">;</span>

<span class="nv">$browser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HttpBrowser</span><span class="p">();</span>

<span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$browser</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="s1">'https://books.toscrape.com/'</span><span class="p">);</span>

<span class="nv">$libros</span> <span class="o">=</span> <span class="p">[];</span>

<span class="c1">// El becario intentó iterar sobre cada libro...</span>
<span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">'div.product_pod'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">each</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$node</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...y extraer el título y el precio.</span>
    <span class="nv">$titulo</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">'h3'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">();</span>
    <span class="nv">$precio</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">'p.price'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">();</span>

    <span class="nv">$libros</span><span class="p">[</span><span class="nv">$titulo</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$precio</span><span class="p">;</span>
<span class="p">});</span>

<span class="nb">print_r</span><span class="p">(</span><span class="nv">$libros</span><span class="p">);</span>
</code></pre></div></p>
<h5 id="tarea-a-realizar"><strong>Tarea a realizar:</strong></h5>
<ol>
<li>Ejecuta el código tal cual y observa el resultado. ¿Por qué está vacío o da error?</li>
<li>Inspecciona la estructura HTML de un libro en <code>books.toscrape.com</code>.</li>
<li>Identifica los selectores CSS incorrectos en el script del becario.</li>
<li>Corrige el código para que extraiga correctamente el título (el texto completo, no solo una parte) y el precio.</li>
<li>Asegúrate de que la variable <code>$libros</code> se popule correctamente. Ten en cuenta que la función anónima (<code>closure</code>) tiene su propio ámbito.</li>
</ol>
<h5 id="aplicacion-en-el-mundo-real"><strong>Aplicación en el Mundo Real:</strong></h5>
<p>La depuración es el 90% del trabajo de un programador. Saber leer el código de otros, identificar fallos lógicos o de selección y corregirlos es una habilidad diaria y fundamental en cualquier equipo de desarrollo.</p>
<details class="success">
<summary>VER Solución.</summary>
<p>El código original tiene tres problemas principales:
1.  <strong>Selector de Precio Incorrecto:</strong> El selector <code>p.price</code> no existe. La clase correcta es <code>price_color</code>.
2.  <strong>Selector de Título Incompleto:</strong> El selector <code>h3</code> apunta al <code>&lt;h3&gt;</code>, pero el título completo está en el atributo <code>title</code> de la etiqueta <code>&lt;a&gt;</code> que está dentro. Extraer <code>-&gt;text()</code> del <code>&lt;h3&gt;</code> solo daría parte del texto y no es lo ideal.
3.  <strong>Ámbito de la Variable:</strong> La variable <code>$libros</code> está siendo modificada dentro de un <em>closure</em>. Para que la variable externa sea modificada, debe pasarse por referencia usando la palabra clave <code>use (&amp;$libros)</code>.</p>
<p><strong>Código Corregido:</strong>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="c1">// Fichero: debug_scraper_solucion.php</span>
<span class="k">require</span> <span class="s1">'vendor/autoload.php'</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\BrowserKit\HttpBrowser</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\DomCrawler\Crawler</span><span class="p">;</span>

<span class="nv">$browser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HttpBrowser</span><span class="p">();</span>

<span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$browser</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="s1">'https://books.toscrape.com/'</span><span class="p">);</span>

<span class="nv">$libros</span> <span class="o">=</span> <span class="p">[];</span>

<span class="c1">// El selector del contenedor principal ('article.product_pod') era más preciso.</span>
<span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">'article.product_pod'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">each</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">Crawler</span> <span class="nv">$node</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="o">&amp;</span><span class="nv">$libros</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 1. Selector de título corregido y apuntando al atributo 'title' del enlace.</span>
    <span class="nv">$titulo</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">'h3 a'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">attr</span><span class="p">(</span><span class="s1">'title'</span><span class="p">);</span>

    <span class="c1">// 2. Selector de precio corregido.</span>
    <span class="nv">$precio</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">'.price_color'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">();</span>

    <span class="c1">// 3. La variable $libros se pasa por referencia.</span>
    <span class="nv">$libros</span><span class="p">[</span><span class="nv">$titulo</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$precio</span><span class="p">;</span>
<span class="p">});</span>

<span class="nb">print_r</span><span class="p">(</span><span class="nv">$libros</span><span class="p">);</span>
</code></pre></div></p>
</details>
</div>
<div class="admonition abstract">
<p class="admonition-title">2) Ficha Técnica de Competidor: Extracción Selectiva | Nivel: Fácil</p>
<h5 id="objetivo_1"><strong>Objetivo:</strong></h5>
<p>Practicar la navegación a una página de detalle y el uso de selectores precisos (XPath o CSS) para extraer datos tabulares específicos.</p>
<h5 id="tarea-a-realizar_1"><strong>Tarea a realizar:</strong></h5>
<p>El equipo de producto de MarketPulse necesita datos muy concretos de los productos de la competencia. Tu tarea es crear un script que:
1.  Navegue a la página principal de <code>books.toscrape.com</code>.
2.  Haga clic en el primer libro de la lista ("A Light in the Attic").
3.  Una vez en la página de detalle del libro, extraiga la siguiente información de la tabla "Product Information":
    *   El código UPC.
    *   El precio, incluyendo los impuestos (<code>Price (incl. tax)</code>).
    *   El número de unidades disponibles en stock.
4.  El script debe imprimir un array asociativo con estos tres datos.</p>
<h5 id="setup-inicial_1"><strong>Setup Inicial:</strong></h5>
<p>Utiliza el componente <code>Symfony\Component\BrowserKit\HttpBrowser</code>.</p>
<h5 id="aplicacion-en-el-mundo-real_1"><strong>Aplicación en el Mundo Real:</strong></h5>
<p>Muchas webs (e-commerce, portales de finanzas, etc.) muestran datos clave en tablas. Ser capaz de apuntar a una fila (<code>&lt;tr&gt;</code>) específica por su encabezado (<code>&lt;th&gt;</code>) y luego extraer el dato de la celda contigua (<code>&lt;td&gt;</code>) es una técnica de scraping extremadamente común y útil.</p>
<details class="success">
<summary>VER Solución.</summary>
<p>La clave de esta solución es usar un selector que pueda localizar el texto en la cabecera de la tabla (<code>&lt;th&gt;</code>) y luego navegar a la siguiente celda (<code>&lt;td&gt;</code>) para obtener el valor. XPath es particularmente bueno para esto.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="c1">// Fichero: ficha_tecnica.php</span>
<span class="k">require</span> <span class="s1">'vendor/autoload.php'</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\BrowserKit\HttpBrowser</span><span class="p">;</span>

<span class="nv">$browser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HttpBrowser</span><span class="p">();</span>

<span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$browser</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="s1">'https://books.toscrape.com/'</span><span class="p">);</span>

<span class="c1">// 1. Buscamos el enlace del primer libro y hacemos clic.</span>
<span class="nv">$enlacePrimerLibro</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">'article.product_pod h3 a'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">link</span><span class="p">();</span>
<span class="nv">$paginaLibro</span> <span class="o">=</span> <span class="nv">$browser</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="nv">$enlacePrimerLibro</span><span class="p">);</span>

<span class="c1">// 2. Función auxiliar para extraer datos de la tabla usando XPath.</span>
<span class="c1">// Encuentra un &lt;th&gt; que contiene un texto, sube a su padre &lt;tr&gt;,</span>
<span class="c1">// y luego baja al siguiente &lt;td&gt;.</span>
<span class="nv">$extractor</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nx">string</span> <span class="nv">$thText</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$paginaLibro</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$paginaLibro</span><span class="o">-&gt;</span><span class="na">filterXPath</span><span class="p">(</span><span class="s2">"//th[text()='</span><span class="si">$thText</span><span class="s2">']/following-sibling::td"</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">();</span>
<span class="p">};</span>

<span class="c1">// 3. Extraemos los datos.</span>
<span class="nv">$upc</span> <span class="o">=</span> <span class="nv">$extractor</span><span class="p">(</span><span class="s1">'UPC'</span><span class="p">);</span>
<span class="nv">$precioConImpuestos</span> <span class="o">=</span> <span class="nv">$extractor</span><span class="p">(</span><span class="s1">'Price (incl. tax)'</span><span class="p">);</span>

<span class="c1">// Para el stock, necesitamos limpiar un poco el texto.</span>
<span class="nv">$stockTexto</span> <span class="o">=</span> <span class="nv">$extractor</span><span class="p">(</span><span class="s1">'Availability'</span><span class="p">);</span> <span class="c1">// "In stock (22 available)"</span>
<span class="nb">preg_match</span><span class="p">(</span><span class="s1">'/\((\d+) available\)/'</span><span class="p">,</span> <span class="nv">$stockTexto</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">);</span>
<span class="nv">$stockNumerico</span> <span class="o">=</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="p">(</span><span class="nv">$matches</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">??</span> <span class="mi">0</span><span class="p">);</span>

<span class="nv">$fichaTecnica</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'upc'</span> <span class="o">=&gt;</span> <span class="nv">$upc</span><span class="p">,</span>
    <span class="s1">'precio_final'</span> <span class="o">=&gt;</span> <span class="nv">$precioConImpuestos</span><span class="p">,</span>
    <span class="s1">'stock'</span> <span class="o">=&gt;</span> <span class="nv">$stockNumerico</span><span class="p">,</span>
<span class="p">];</span>

<span class="nb">print_r</span><span class="p">(</span><span class="nv">$fichaTecnica</span><span class="p">);</span>
</code></pre></div>
</details>
</div>
<h2 id="ejercicios-de-refuerzo">Ejercicios de Refuerzo</h2>
<div class="admonition warning">
<p class="admonition-title">3) Rastreador Multi-Página: Compilando un Catálogo Completo | Nivel: Medio</p>
<h5 id="objetivo_2"><strong>Objetivo:</strong></h5>
<p>Implementar un scraper capaz de navegar a través de la paginación de un sitio web para recopilar datos de múltiples páginas.</p>
<h5 id="tarea-a-realizar_2"><strong>Tarea a realizar:</strong></h5>
<p>MarketPulse necesita el catálogo completo de una categoría, no solo la primera página. Tu misión es crear un script que:
1.  Vaya a la categoría "Science Fiction" de <code>books.toscrape.com</code>: <code>http://books.toscrape.com/catalogue/category/books/science-fiction_16/index.html</code>.
2.  Extraiga el título y precio de todos los libros de la página actual.
3.  Busque el enlace "next" de la paginación.
4.  Si existe, haga clic en él y repita el paso 2 en la nueva página.
5.  El proceso debe continuar hasta que ya no haya un enlace "next", lo que significa que ha llegado a la última página.
6.  El script debe almacenar todos los libros encontrados en un único array y mostrar el número total de libros al final.</p>
<h5 id="pistas"><strong>Pistas:</strong></h5>
<ul>
<li>Usa un bucle <code>do-while</code> o <code>while</code> para gestionar la navegación entre páginas.</li>
<li>Para comprobar si el enlace "next" existe, puedes usar <code>$crawler-&gt;filter('li.next a')-&gt;count()</code>. Si es mayor que 0, existe.</li>
<li>Para obtener el objeto <code>Link</code> y hacer clic, puedes hacer <code>$crawler-&gt;filter('li.next a')-&gt;link()</code>.</li>
</ul>
<h5 id="aplicacion-en-el-mundo-real_2"><strong>Aplicación en el Mundo Real:</strong></h5>
<p>Casi ningún listado de datos de interés (resultados de búsqueda, catálogos de productos, listas de artículos) cabe en una sola página. La capacidad de programar un "crawler" o "araña" que siga la paginación de forma autónoma es lo que diferencia un script simple de un verdadero sistema de recolección de datos.</p>
<details class="success">
<summary>VER Solución.</summary>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="c1">// Fichero: crawler_paginacion.php</span>
<span class="k">require</span> <span class="s1">'vendor/autoload.php'</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\BrowserKit\HttpBrowser</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\DomCrawler\Crawler</span><span class="p">;</span>

<span class="nv">$browser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HttpBrowser</span><span class="p">();</span>

<span class="nv">$urlInicial</span> <span class="o">=</span> <span class="s1">'http://books.toscrape.com/catalogue/category/books/science-fiction_16/index.html'</span><span class="p">;</span>
<span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$browser</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nv">$urlInicial</span><span class="p">);</span>

<span class="nv">$catalogoCompleto</span> <span class="o">=</span> <span class="p">[];</span>

<span class="k">echo</span> <span class="s2">"Iniciando rastreo de la categoría 'Science Fiction'...</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>

<span class="k">do</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"Scrapeando página: "</span> <span class="o">.</span> <span class="nv">$browser</span><span class="o">-&gt;</span><span class="na">getHistory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getUri</span><span class="p">()</span> <span class="o">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>

    <span class="c1">// Extraemos los datos de la página actual</span>
    <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">'article.product_pod'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">each</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">Crawler</span> <span class="nv">$node</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="o">&amp;</span><span class="nv">$catalogoCompleto</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$titulo</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">'h3 a'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">attr</span><span class="p">(</span><span class="s1">'title'</span><span class="p">);</span>
        <span class="nv">$precio</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">'.price_color'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">();</span>
        <span class="nv">$catalogoCompleto</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'titulo'</span> <span class="o">=&gt;</span> <span class="nv">$titulo</span><span class="p">,</span> <span class="s1">'precio'</span> <span class="o">=&gt;</span> <span class="nv">$precio</span><span class="p">];</span>
    <span class="p">});</span>

    <span class="c1">// Buscamos el enlace a la siguiente página</span>
    <span class="nv">$nextLinkNode</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">'li.next a'</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$nextLinkNode</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Si existe, hacemos clic</span>
        <span class="nv">$link</span> <span class="o">=</span> <span class="nv">$nextLinkNode</span><span class="o">-&gt;</span><span class="na">link</span><span class="p">();</span>
        <span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$browser</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="nv">$link</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="nv">$nextLinkNode</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// El bucle se detiene cuando no hay más enlaces "next"</span>

<span class="k">echo</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">--- Rastreo completado ---</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">"Total de libros encontrados: "</span> <span class="o">.</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$catalogoCompleto</span><span class="p">)</span> <span class="o">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<span class="c1">// print_r($catalogoCompleto);</span>
</code></pre></div>
</details>
</div>
<h2 id="ejercicios-de-ampliacion">Ejercicios de Ampliación</h2>
<div class="admonition danger">
<p class="admonition-title">4) El Reto Dinámico: Scrapeando con Panther | Nivel: Alto</p>
<h5 id="objetivo_3"><strong>Objetivo:</strong></h5>
<p>Utilizar un navegador headless (Symfony Panther) para extraer datos de una página web que depende de JavaScript para renderizar su contenido y para la paginación.</p>
<h5 id="tarea-a-realizar_3"><strong>Tarea a realizar:</strong></h5>
<p>Un objetivo clave para MarketPulse es el sitio <code>http://quotes.toscrape.com/js/</code>, que carga sus citas dinámicamente con JavaScript. Los scrapers basados en Guzzle o HttpBrowser solo ven una página en blanco.
Tu reto consiste en:
1.  Usar Symfony Panther para navegar a <code>http://quotes.toscrape.com/js/</code>.
2.  Extraer todas las citas y sus autores de la página.
3.  El sitio no tiene paginación tradicional, sino un botón "Next" que carga más citas en la misma página usando JS. Debes programar el script para que haga clic en ese botón repetidamente.
4.  Después de cada clic, el script debe esperar a que las nuevas citas se carguen antes de continuar.
5.  El proceso se detiene cuando el botón "Next" desaparece del DOM.
6.  El script debe finalizar mostrando el número total de citas y autores recopilados.</p>
<h5 id="aplicacion-en-el-mundo-real_3"><strong>Aplicación en el Mundo Real:</strong></h5>
<p>La web moderna es dinámica. Dominar el scraping con navegadores headless es una habilidad imprescindible y de alto valor para extraer datos de aplicaciones web interactivas (Single Page Applications o SPAs construidas con React, Vue, Angular, etc.), que son la norma hoy en día.</p>
<h5 id="revision-por-pares-peer-review"><strong>Revisión por Pares (Peer Review):</strong></h5>
<p>Una vez que tengas una solución funcional, intercámbiala con un compañero. Revisa su código y ofrécele feedback constructivo sobre estos puntos:
1.  <strong>Claridad del Código:</strong> ¿El código es legible y autoexplicativo? ¿Los nombres de las variables son claros?
2.  <strong>Manejo de Esperas:</strong> ¿Se utilizan <code>sleep()</code> (una mala práctica porque introduce retardos fijos) o se usan métodos de espera inteligentes de Panther como <code>-&gt;waitFor()</code> o <code>-&gt;waitForVisibility()</code>? ¿Cómo podría mejorarse?
3.  <strong>Robustez:</strong> ¿Qué pasaría si la web tarda mucho en responder? ¿El script tiene algún <code>timeout</code> o manejo de errores? ¿Cómo se detecta el final de la paginación de forma fiable?</p>
<details class="success">
<summary>VER Solución.</summary>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="c1">// Fichero: panther_dinamico.php</span>
<span class="k">require</span> <span class="s1">'vendor/autoload.php'</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Panther\Client</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\DomCrawler\Crawler</span><span class="p">;</span>

<span class="k">echo</span> <span class="s2">"Iniciando Panther para scrapear una web con JS...</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>

<span class="c1">// Usamos Firefox en este caso para variar. Panther buscará el geckodriver.</span>
<span class="nv">$client</span> <span class="o">=</span> <span class="nx">Client</span><span class="o">::</span><span class="na">createFirefoxClient</span><span class="p">();</span>

<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="s1">'http://quotes.toscrape.com/js/'</span><span class="p">);</span>

<span class="nv">$citasRecopiladas</span> <span class="o">=</span> <span class="p">[];</span>

<span class="k">while</span> <span class="p">(</span><span class="k">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Esperamos a que el contenedor de las citas esté visible</span>
    <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">waitForVisibility</span><span class="p">(</span><span class="s1">'.quote'</span><span class="p">);</span>

    <span class="c1">// Recolectamos las citas de la página actual</span>
    <span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getCrawler</span><span class="p">();</span>
    <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">'.quote'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">each</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">Crawler</span> <span class="nv">$node</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="o">&amp;</span><span class="nv">$citasRecopiladas</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$texto</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">'.text'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">();</span>
        <span class="nv">$autor</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">'.author'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">();</span>

        <span class="c1">// Evitamos duplicados por si el scraping es más rápido que la carga</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$citasRecopiladas</span><span class="p">[</span><span class="nv">$texto</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nv">$citasRecopiladas</span><span class="p">[</span><span class="nv">$texto</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$autor</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="c1">// Verificamos si el botón "Next" existe Y es visible</span>
    <span class="nv">$botonNext</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">'li.next a'</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$botonNext</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">()</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">"Botón 'Next' no encontrado. Fin del scraping.</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">echo</span> <span class="s2">"Citas encontradas hasta ahora: "</span> <span class="o">.</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$citasRecopiladas</span><span class="p">)</span> <span class="o">.</span> <span class="s2">". Pulsando 'Next'...</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>

    <span class="c1">// Hacemos clic en el botón</span>
    <span class="nv">$botonNext</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">();</span>

    <span class="c1">// Podríamos añadir una espera explícita a que un elemento nuevo aparezca,</span>
    <span class="c1">// pero el waitForVisibility al inicio del bucle ya se encarga de eso.</span>
<span class="p">}</span>

<span class="k">echo</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">--- Scraping con Panther completado ---</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">"Total de citas únicas recopiladas: "</span> <span class="o">.</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$citasRecopiladas</span><span class="p">)</span> <span class="o">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>

<span class="c1">// foreach ($citasRecopiladas as $cita =&gt; $autor) {</span>
<span class="c1">//     echo "- \"$cita\" - $autor\n";</span>
<span class="c1">// }</span>

<span class="c1">// ¡Importante! Cerrar el navegador para liberar recursos.</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">quit</span><span class="p">();</span>
</code></pre></div>
</details>
</div>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.top"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script><script type="text/javascript">(function initializeMarkmap() {
    const transformer = new markmap.Transformer();
    const preloadScripts = transformer.plugins
        .flatMap((plugin) => plugin.config?.preloadScripts || [])
        .map((item) => transformer.resolveJS(item));
    const assets = transformer.getAssets();
    const loading = Promise.all([
        assets.styles && markmap.loadCSS(assets.styles),
        markmap.loadJS([...preloadScripts, ...assets.scripts]),
    ]);

    function parseData(content) {
        const { root, frontmatter } = transformer.transform(content);
        let options = markmap.deriveOptions(frontmatter?.markmap);
        options = Object.assign(
            {
                fitRatio: 0.85,
            },
            options
        );
        return { root, options };
    }

    function resetMarkmap(m, el) {
        if (!m.state.rect) return;
        const { x1, y1, x2, y2 } = m.state.rect;
        const height = (el.offsetWidth / (x2 - x1)) * (y2 - y1);
        el.style.height = height + "px";
        m.fit();
    }

    function decodeBase64(encoded) {
        const binary = atob(encoded);
        const bytes = new Uint8Array(binary.length);
        for (let i = 0; i < bytes.length; i++) {
            bytes[i] = binary.charCodeAt(i);
        }
        return new TextDecoder().decode(bytes);
    }

    function renderMarkmap(el) {
        const dataEl = el.querySelector("markmap-data");
        if (!dataEl) return;
        let content = el.textContent;
        if (dataEl.getAttribute("encoding") === "base64") {
            content = decodeBase64(content);
        }
        el.innerHTML = "<svg>";
        svg = el.firstChild;
        const { root, options } = parseData(content);
        const m = markmap.Markmap.create(svg, options);
        m.setData(root);
        requestAnimationFrame(() => {
            resetMarkmap(m, el);
        });
    }

    function updateMarkmaps(node) {
        for (const el of node.querySelectorAll(".mkdocs-markmap")) {
            renderMarkmap(el);
        }
    }

    loading.then(() => {
        const observer = new MutationObserver((mutationList) => {
            for (const mutation of mutationList) {
                if (mutation.type === "childList") {
                    for (const node of mutation.addedNodes) {
                        updateMarkmaps(node);
                    }
                }
            }
        });

        observer.observe(document.body, { childList: true });

        updateMarkmaps(document);
    });
})();
</script></body>
</html>